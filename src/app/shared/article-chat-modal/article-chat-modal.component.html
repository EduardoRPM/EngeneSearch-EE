<button
  type="button"
  class="inline-flex items-center gap-2 px-4 py-2 bg-[#384CBF] text-white rounded-lg hover:bg-[#384CBF]/90 transition-colors"
  (click)="open()"
>
  {{ triggerLabel }}
</button>

<div *ngIf="isOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4">
  <div class="relative w-full max-w-2xl bg-background rounded-2xl shadow-xl border border-border max-h-full overflow-hidden flex flex-col">
    <header class="flex items-start justify-between gap-4 border-b border-border px-6 py-4">
      <div>
        <p class="text-xs uppercase tracking-wide text-muted-foreground">You are talking with</p>
        <h2 class="text-lg font-semibold text-foreground leading-tight line-clamp-2">{{ article.title }}</h2>
      </div>
      <button type="button" class="text-muted-foreground hover:text-foreground transition-colors" (click)="close()" aria-label="Close chat">
        ×
      </button>
    </header>

    <div class="flex-1 overflow-y-auto px-6 py-4 space-y-3">
      <p *ngIf="!messages.length && !isLoading" class="text-sm text-muted-foreground">Start the conversation with a question</p>

      <div
        *ngFor="let message of messages"
        class="max-w-[85%] rounded-lg px-4 py-3 text-sm leading-relaxed shadow-sm"
        [ngClass]="message.role === 'user' ? 'ml-auto bg-[#384CBF] text-white' : 'mr-auto bg-secondary text-secondary-foreground'"
      >
        <span class="whitespace-pre-wrap">{{ message.content }}</span>
      </div>

      <div *ngIf="isLoading" class="mr-auto max-w-[70%] rounded-lg px-4 py-3 text-sm bg-secondary text-secondary-foreground shadow-sm">
        Loading…
      </div>

      <div #chatEnd></div>
    </div>

    <form (ngSubmit)="submit()" class="border-t border-border px-6 py-4 space-y-3">
      <textarea
        #textarea
        [(ngModel)]="question"
        name="question"
        placeholder="Write your question..."
        rows="3"
        class="w-full rounded-lg border border-border bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-[#384CBF]"
        [disabled]="isLoading"
        required
      ></textarea>
      <div class="flex items-center justify-end gap-3">
        <button type="button" class="px-4 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors" (click)="close()">
          Cancel
        </button>
        <button
          type="submit"
          class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white rounded-lg bg-[#384CBF] hover:bg-[#384CBF]/90 transition-colors disabled:opacity-60"
          [disabled]="isLoading"
        >
          {{ isLoading ? 'Sending...' : 'Send' }}
        </button>
      </div>
    </form>
  </div>
</div>
